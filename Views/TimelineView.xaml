<UserControl x:Class="BacklogManager.Views.TimelineView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:local="clr-namespace:BacklogManager.Domain"
             Background="#F5F5F5">
    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="White" CornerRadius="6" Padding="15" Margin="0,0,0,15">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.15" Color="#00915A"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ“… TIMELINE" FontSize="22" FontWeight="Bold" Foreground="#1A1919"/>
                <TextBlock Text="BNP Paribas" FontSize="16" Foreground="#00915A" 
                           VerticalAlignment="Center" Margin="15,0,0,0" FontWeight="Medium"/>
            </StackPanel>
        </Border>

        <!-- Filters Bar -->
        <Border Grid.Row="1" Background="White" CornerRadius="6" Padding="15" Margin="0,0,0,15">
            <Border.Effect>
                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.15" Color="#00915A"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="ðŸ” Filtres:" FontWeight="Bold" FontSize="14" 
                           VerticalAlignment="Center" Margin="0,0,10,0"/>
                
                <TextBlock Text="Dev:" FontSize="13" VerticalAlignment="Center" Margin="10,0,5,0"/>
                <ComboBox ItemsSource="{Binding Devs}" DisplayMemberPath="Nom"
                          SelectedValue="{Binding SelectedDevId}" SelectedValuePath="Id" 
                          Width="150" Padding="8,5" Margin="0,0,15,0"/>
                
                <TextBlock Text="Projet:" FontSize="13" VerticalAlignment="Center" Margin="10,0,5,0"/>
                <ComboBox ItemsSource="{Binding Projets}" DisplayMemberPath="Nom"
                          SelectedValue="{Binding SelectedProjetId}" SelectedValuePath="Id" 
                          Width="150" Padding="8,5" Margin="0,0,15,0"/>

                <TextBlock Text="Statut:" FontSize="13" VerticalAlignment="Center" Margin="10,0,5,0"/>
                <ComboBox ItemsSource="{Binding Source={x:Type local:Statut}, Converter={StaticResource EnumToCollectionConverter}}"
                          SelectedItem="{Binding SelectedStatut}"
                          Width="120" Padding="8,5" Margin="0,0,15,0"/>
                
                <Button Content="ðŸ”„ Actualiser" Command="{Binding RefreshCommand}"
                        Padding="10,5" Margin="0,0,10,0" Background="#00915A" Foreground="White" 
                        BorderThickness="0" FontSize="12" FontWeight="SemiBold" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="4" 
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#007A4D"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button Content="ðŸ—‘ï¸ Effacer filtres" Command="{Binding ClearFiltersCommand}"
                        Padding="10,5" Background="#E0E0E0" Foreground="#333" 
                        BorderThickness="0" FontSize="12" FontWeight="SemiBold" Cursor="Hand">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="4" 
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#D0D0D0"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Border>

        <!-- Timeline Items -->
        <ScrollViewer Grid.Row="2" VerticalScrollBarVisibility="Auto">
            <ItemsControl ItemsSource="{Binding TimelineItems}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" CornerRadius="6" Padding="15" Margin="0,0,0,15">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="10" ShadowDepth="0" Opacity="0.15" Color="#00915A"/>
                            </Border.Effect>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- Header with title and status -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{Binding Item.Titre}" FontSize="16" FontWeight="Bold" 
                                                   Foreground="#1A1919" TextWrapping="Wrap"/>
                                        <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                            <TextBlock Text="ðŸ‘¤ " FontSize="12"/>
                                            <TextBlock Text="{Binding DevName}" FontSize="12" Foreground="#00915A" FontWeight="SemiBold"/>
                                            <TextBlock Text=" â€¢ ðŸ“ " FontSize="12" Margin="10,0,0,0"/>
                                            <TextBlock Text="{Binding ProjetName}" FontSize="12" Foreground="#6D6D6D"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <Border Grid.Column="1" Padding="10,5" CornerRadius="4" VerticalAlignment="Top">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#00915A"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Item.Statut}" Value="Afaire">
                                                        <Setter Property="Background" Value="#9E9E9E"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Item.Statut}" Value="EnCours">
                                                        <Setter Property="Background" Value="#2196F3"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Item.Statut}" Value="Test">
                                                        <Setter Property="Background" Value="#FF9800"/>
                                                    </DataTrigger>
                                                    <DataTrigger Binding="{Binding Item.Statut}" Value="Termine">
                                                        <Setter Property="Background" Value="#4CAF50"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding Item.Statut}" Foreground="White" 
                                                   FontSize="11" FontWeight="Bold"/>
                                    </Border>
                                </Grid>

                                <!-- Dates -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,10,0,10">
                                    <Border Background="#E8F5E9" CornerRadius="4" Padding="8,4" Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸŽ¬ DÃ©but: " FontSize="11" Foreground="#2E7D32" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Item.DateCreation, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                                       FontSize="11" Foreground="#2E7D32"/>
                                        </StackPanel>
                                    </Border>

                                    <Border Background="#FFEBEE" CornerRadius="4" Padding="8,4">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸŽ¯ Deadline: " FontSize="11" Foreground="#C62828" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding Item.DateFinAttendue, StringFormat='{}{0:dd/MM/yyyy}'}" 
                                                       FontSize="11" Foreground="#C62828"/>
                                        </StackPanel>
                                    </Border>

                                    <Border Padding="8,4" Margin="10,0,0,0" CornerRadius="4">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E8F5E9"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                        <Setter Property="Background" Value="#FFF3E0"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock FontSize="11" FontWeight="Bold">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#2E7D32"/>
                                                    <Setter Property="Text" Value="{Binding ProgressStatus}"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                            <Setter Property="Foreground" Value="#EF6C00"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>
                                    </Border>
                                </StackPanel>

                                <!-- Progress Bar -->
                                <Grid Grid.Row="2" Margin="0,0,0,10">
                                    <Border Height="30" Background="#E0E0E0" CornerRadius="4"/>
                                    <Border Height="30" CornerRadius="4" HorizontalAlignment="Left">
                                        <Border.Width>
                                            <MultiBinding Converter="{StaticResource ProgressWidthConverter}">
                                                <Binding Path="ProgressPercentage"/>
                                                <Binding RelativeSource="{RelativeSource AncestorType=Grid}" Path="ActualWidth"/>
                                            </MultiBinding>
                                        </Border.Width>
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#00915A"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                        <Setter Property="Background" Value="#F57C00"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <TextBlock Text="{Binding ProgressPercentage, StringFormat='{}{0:F0}%'}" 
                                                   Foreground="White" FontWeight="Bold" FontSize="12"
                                                   VerticalAlignment="Center" HorizontalAlignment="Center"/>
                                    </Border>
                                </Grid>

                                <!-- Stats -->
                                <StackPanel Grid.Row="3" Orientation="Horizontal">
                                    <Border Background="#E3F2FD" CornerRadius="4" Padding="8,4" Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸ“Š DurÃ©e totale: " FontSize="11" Foreground="#1976D2" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding DaysTotal}" FontSize="11" Foreground="#1976D2"/>
                                            <TextBlock Text=" jours" FontSize="11" Foreground="#1976D2"/>
                                        </StackPanel>
                                    </Border>

                                    <Border Background="#FFF3E0" CornerRadius="4" Padding="8,4" Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="â±ï¸ Jours Ã©coulÃ©s: " FontSize="11" Foreground="#F57C00" FontWeight="SemiBold"/>
                                            <TextBlock Text="{Binding DaysElapsed}" FontSize="11" Foreground="#F57C00"/>
                                            <TextBlock Text=" jours" FontSize="11" Foreground="#F57C00"/>
                                        </StackPanel>
                                    </Border>

                                    <Border CornerRadius="4" Padding="8,4">
                                        <Border.Style>
                                            <Style TargetType="Border">
                                                <Setter Property="Background" Value="#E8F5E9"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                        <Setter Property="Background" Value="#FFEBEE"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Border.Style>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="â³ Jours restants: " FontSize="11" FontWeight="SemiBold">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                                <Setter Property="Foreground" Value="#C62828"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <TextBlock Text="{Binding DaysRemaining}" FontSize="11">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                                <Setter Property="Foreground" Value="#C62828"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                            <TextBlock Text=" jours" FontSize="11">
                                                <TextBlock.Style>
                                                    <Style TargetType="TextBlock">
                                                        <Setter Property="Foreground" Value="#2E7D32"/>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding DaysRemaining}" Value="0">
                                                                <Setter Property="Foreground" Value="#C62828"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
