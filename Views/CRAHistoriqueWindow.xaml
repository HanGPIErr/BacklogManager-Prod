<Window x:Class="BacklogManager.Views.CRAHistoriqueWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Historique CRA" 
        Height="700" 
        Width="1000"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5">
    <Window.Resources>
        <Style TargetType="Label">
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="ComboBox">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
        <Style TargetType="DatePicker">
            <Setter Property="Height" Value="30"/>
            <Setter Property="Margin" Value="5"/>
        </Style>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Titre -->
        <TextBlock Grid.Row="0" 
                   Text="Historique des CRA" 
                   FontSize="22" 
                   FontWeight="Bold" 
                   Foreground="#2C3E50"
                   Margin="0,0,0,15"/>

        <!-- Filtres -->
        <Border Grid.Row="1" 
                Padding="15"
                Background="White"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                CornerRadius="5"
                Margin="0,0,0,15">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Ligne 1 : Dates et Dev -->
                <Label Grid.Row="0" Grid.Column="0" Content="Du :" VerticalAlignment="Center"/>
                <DatePicker Grid.Row="0" Grid.Column="1" 
                            SelectedDate="{Binding DateDebut, Mode=TwoWay}"/>

                <Label Grid.Row="0" Grid.Column="2" Content="Au :" VerticalAlignment="Center"/>
                <DatePicker Grid.Row="0" Grid.Column="3" 
                            SelectedDate="{Binding DateFin, Mode=TwoWay}"/>

                <!-- Ligne 2 : Filtres supplÃ©mentaires -->
                <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="5" 
                            Orientation="Horizontal"
                            Margin="0,10,0,0">
                    <Label Content="DÃ©veloppeur :" VerticalAlignment="Center"/>
                    <ComboBox Width="200"
                              ItemsSource="{Binding Devs}"
                              SelectedItem="{Binding DevFiltre, Mode=TwoWay}"
                              DisplayMemberPath="Nom"
                              IsEnabled="{Binding CanFilterAllDevs}"/>

                    <Label Content="Projet :" VerticalAlignment="Center" Margin="20,5,5,5"/>
                    <ComboBox Width="200"
                              ItemsSource="{Binding Projets}"
                              SelectedItem="{Binding ProjetFiltre, Mode=TwoWay}"
                              DisplayMemberPath="Nom"/>

                    <Button Content="Aujourd'hui" 
                            Width="90" 
                            Height="30"
                            Margin="20,5,5,5"
                            Command="{Binding FilterTodayCommand}"/>
                    <Button Content="Semaine" 
                            Width="80" 
                            Height="30"
                            Margin="5"
                            Command="{Binding FilterWeekCommand}"/>
                    <Button Content="Mois" 
                            Width="70" 
                            Height="30"
                            Margin="5"
                            Command="{Binding FilterMonthCommand}"/>
                    <Button Content="Tout" 
                            Width="60" 
                            Height="30"
                            Margin="5"
                            Command="{Binding FilterAllCommand}"/>
                    <Button Content="ðŸ” Rechercher" 
                            Width="110" 
                            Height="30"
                            Margin="15,5,5,5"
                            Background="#3498DB"
                            Foreground="White"
                            FontWeight="Bold"
                            Command="{Binding LoadCRAsCommand}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- DataGrid -->
        <DataGrid Grid.Row="2"
                  ItemsSource="{Binding CRAs}"
                  AutoGenerateColumns="False"
                  IsReadOnly="True"
                  Background="White"
                  AlternatingRowBackground="#F9F9F9"
                  GridLinesVisibility="Horizontal"
                  HorizontalGridLinesBrush="#E0E0E0"
                  RowHeight="35"
                  HeadersVisibility="Column"
                  SelectionMode="Single"
                  CanUserResizeRows="False">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Date" 
                                    Binding="{Binding Date}" 
                                    Width="100"/>
                <DataGridTextColumn Header="DÃ©veloppeur" 
                                    Binding="{Binding DevNom}" 
                                    Width="150"/>
                <DataGridTextColumn Header="Projet" 
                                    Binding="{Binding ProjetNom}" 
                                    Width="150"/>
                <DataGridTextColumn Header="TÃ¢che" 
                                    Binding="{Binding TacheNom}" 
                                    Width="*"/>
                <DataGridTextColumn Header="Jours" 
                                    Binding="{Binding Jours, StringFormat='{}{0:F1}j'}" 
                                    Width="80"/>
                <DataGridTextColumn Header="Commentaire" 
                                    Binding="{Binding Commentaire}" 
                                    Width="200"/>
                <DataGridTemplateColumn Header="Actions" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="ðŸ—‘ï¸" 
                                    Width="30" 
                                    Height="25"
                                    Background="#E74C3C"
                                    Foreground="White"
                                    FontSize="12"
                                    Command="{Binding DataContext.DeleteCRACommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                    CommandParameter="{Binding Id}"
                                    ToolTip="Supprimer ce CRA"/>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
            <DataGrid.ColumnHeaderStyle>
                <Style TargetType="DataGridColumnHeader">
                    <Setter Property="Background" Value="#34495E"/>
                    <Setter Property="Foreground" Value="White"/>
                    <Setter Property="FontWeight" Value="Bold"/>
                    <Setter Property="Padding" Value="10,8"/>
                    <Setter Property="BorderBrush" Value="#2C3E50"/>
                    <Setter Property="BorderThickness" Value="0,0,1,0"/>
                </Style>
            </DataGrid.ColumnHeaderStyle>
        </DataGrid>

        <!-- Footer statistiques -->
        <Border Grid.Row="3"
                Margin="0,15,0,0"
                Padding="15"
                Background="White"
                BorderBrush="#E0E0E0"
                BorderThickness="1"
                CornerRadius="5">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <TextBlock Text="ðŸ“Š " FontSize="16" VerticalAlignment="Center"/>
                    <TextBlock Text="Nombre de CRA : " 
                               FontWeight="SemiBold" 
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding TotalCRA}" 
                               FontWeight="Bold"
                               FontSize="16"
                               Foreground="#3498DB"
                               VerticalAlignment="Center"
                               Margin="0,0,30,0"/>
                    
                    <TextBlock Text="Total jours : " 
                               FontWeight="SemiBold" 
                               VerticalAlignment="Center"
                               Margin="0,0,5,0"/>
                    <TextBlock Text="{Binding TotalJours, StringFormat='{}{0:F1}j'}"
                               FontWeight="Bold"
                               FontSize="16"
                               Foreground="#27AE60"
                               VerticalAlignment="Center"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button Content="ðŸ“¤ Exporter CSV" 
                            Width="130" 
                            Height="35"
                            Margin="0,0,10,0"
                            Command="{Binding ExportCommand}"/>
                    <Button Content="Fermer" 
                            Width="100" 
                            Height="35"
                            IsCancel="True"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
