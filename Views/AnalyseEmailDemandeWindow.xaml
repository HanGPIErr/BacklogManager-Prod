<Window x:Class="BacklogManager.Views.AnalyseEmailDemandeWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ðŸ“§ Analyse IA d'Email - Nouvelle Demande" 
        Height="900" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#F5F5F5"
        ResizeMode="CanResize">

    <Window.Resources>
        <Style x:Key="SectionTitle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Foreground" Value="#2C3E50"/>
            <Setter Property="Margin" Value="0,15,0,8"/>
        </Style>

        <Style x:Key="ActionButton" TargetType="Button">
            <Setter Property="Height" Value="40"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="Margin" Value="5"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="6" 
                                BorderThickness="{TemplateBinding BorderThickness}"
                                BorderBrush="{TemplateBinding BorderBrush}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Opacity" Value="0.9"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- En-tÃªte -->
        <Border Grid.Row="0" Background="#6264A7" Padding="20,15">
            <StackPanel>
                <TextBlock Text="ðŸ“§ Analyse IA d'Email pour Nouvelle Demande" 
                          FontSize="20" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="Collez le contenu d'un email et l'IA prÃ©-remplira automatiquement les champs de la demande" 
                          FontSize="12" Foreground="#E0E0E0" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Contenu principal -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
            <StackPanel>
                <!-- Zone de saisie de l'email -->
                <Border Background="White" CornerRadius="8" Padding="15" Margin="0,0,0,15"
                        BorderBrush="#E0E0E0" BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="ðŸ“¨ Contenu de l'Email" Style="{StaticResource SectionTitle}"/>
                        <TextBlock Text="Copiez-collez ici le contenu complet de l'email reÃ§u" 
                                  FontSize="11" Foreground="#757575" Margin="0,0,0,8"/>
                        
                        <TextBox x:Name="TxtEmail" 
                                AcceptsReturn="True" 
                                TextWrapping="Wrap" 
                                VerticalScrollBarVisibility="Auto"
                                Height="200"
                                Padding="10"
                                FontFamily="Consolas"
                                FontSize="11"
                                Background="#FAFAFA"
                                BorderBrush="#BDBDBD"
                                BorderThickness="1"/>

                        <Button x:Name="BtnAnalyser" 
                               Content="ðŸ¤– Analyser avec l'IA" 
                               Style="{StaticResource ActionButton}"
                               Background="#6264A7" 
                               Foreground="White"
                               HorizontalAlignment="Right"
                               Margin="0,10,0,0"
                               Click="BtnAnalyser_Click"/>
                    </StackPanel>
                </Border>

                <!-- Zone de rÃ©sultats (invisible au dÃ©part) -->
                <Border x:Name="PanelResultats" 
                        Visibility="Collapsed"
                        Background="White" 
                        CornerRadius="8" 
                        Padding="20" 
                        BorderBrush="#E0E0E0" 
                        BorderThickness="1">
                    <StackPanel>
                        <TextBlock Text="âœ… Analyse TerminÃ©e - VÃ©rifiez et complÃ©tez les informations" 
                                  FontSize="16" 
                                  FontWeight="Bold" 
                                  Foreground="#27AE60" 
                                  Margin="0,0,0,15"/>

                        <!-- Titre -->
                        <TextBlock Text="ðŸ“ Titre de la demande *" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox x:Name="TxtTitreResult" Padding="10" Height="35" FontSize="13" Margin="0,0,0,15"/>

                        <!-- Type et CriticitÃ© -->
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="10"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="ðŸ·ï¸ Type *" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbTypeResult" Padding="10" Height="35" FontSize="13"/>
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="âš ï¸ CriticitÃ© *" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbCriticiteResult" Padding="10" Height="35" FontSize="13"/>
                            </StackPanel>
                        </Grid>

                        <!-- Description -->
                        <TextBlock Text="ðŸ“„ Description *" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox x:Name="TxtDescriptionResult" 
                                AcceptsReturn="True" 
                                TextWrapping="Wrap" 
                                Height="80" 
                                Padding="10" 
                                FontSize="13"
                                Margin="0,0,0,15"/>

                        <!-- SpÃ©cifications -->
                        <TextBlock Text="âš™ï¸ SpÃ©cifications techniques" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox x:Name="TxtSpecificationsResult" 
                                AcceptsReturn="True" 
                                TextWrapping="Wrap" 
                                Height="100" 
                                Padding="10" 
                                FontSize="13"
                                Margin="0,0,0,15"/>

                        <!-- Contexte mÃ©tier -->
                        <TextBlock Text="ðŸ¢ Contexte mÃ©tier" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox x:Name="TxtContexteResult" 
                                AcceptsReturn="True" 
                                TextWrapping="Wrap" 
                                Height="80" 
                                Padding="10" 
                                FontSize="13"
                                Margin="0,0,0,15"/>

                        <!-- BÃ©nÃ©fices attendus -->
                        <TextBlock Text="ðŸ’¡ BÃ©nÃ©fices attendus" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBox x:Name="TxtBeneficesResult" 
                                AcceptsReturn="True" 
                                TextWrapping="Wrap" 
                                Height="60" 
                                Padding="10" 
                                FontSize="13"
                                Margin="0,0,0,15"/>

                        <!-- SECTION PHASE 2: Programme & Classification -->
                        <Border Background="#E8F5E9" BorderBrush="#00A651" BorderThickness="1" 
                               CornerRadius="5" Padding="15" Margin="0,10,0,15">
                            <StackPanel>
                                <TextBlock Text="PROGRAMME ET CLASSIFICATION" FontWeight="Bold" FontSize="14" 
                                          Foreground="#00A651" Margin="0,0,0,15"/>
                                
                                <!-- Programme -->
                                <TextBlock Text="Programme associÃ©" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbProgrammeResult" Height="35" FontSize="13" Margin="0,0,0,15"/>
                                
                                <!-- PrioritÃ©, Type Projet, CatÃ©gorie -->
                                <Grid Margin="0,0,0,15">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="PrioritÃ© *" FontWeight="Bold" Margin="0,0,0,5"/>
                                        <ComboBox x:Name="CmbPrioriteResult" Height="35" FontSize="13"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2">
                                        <TextBlock Text="Type Projet" FontWeight="Bold" Margin="0,0,0,5"/>
                                        <ComboBox x:Name="CmbTypeProjetResult" Height="35" FontSize="13"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="4">
                                        <TextBlock Text="CatÃ©gorie" FontWeight="Bold" Margin="0,0,0,5"/>
                                        <ComboBox x:Name="CmbCategorieResult" Height="35" FontSize="13"/>
                                    </StackPanel>
                                </Grid>
                                
                                <!-- Lead Projet et Est ImplÃ©mentÃ© -->
                                <Grid Margin="0,0,0,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="Lead Projet" FontWeight="Bold" Margin="0,0,0,5"/>
                                        <ComboBox x:Name="CmbLeadProjetResult" Height="35" FontSize="13"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2">
                                        <CheckBox x:Name="ChkEstImplementeResult" Content="DÃ©jÃ  implÃ©mentÃ©" 
                                                 FontWeight="Bold" VerticalAlignment="Bottom" Margin="0,0,0,8"/>
                                    </StackPanel>
                                </Grid>
                            </StackPanel>
                        </Border>
                        
                        <!-- SECTION PHASE 2: Drivers & Ambition -->
                        <Border Background="#E3F2FD" BorderBrush="#2196F3" BorderThickness="1" 
                               CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="DRIVERS ET AMBITION" FontWeight="Bold" FontSize="14" 
                                          Foreground="#1976D2" Margin="0,0,0,15"/>
                                
                                <!-- Drivers (multi-sÃ©lection) -->
                                <TextBlock Text="Drivers" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock Text="SÃ©lectionnez les drivers applicables (plusieurs choix possibles)" 
                                          FontSize="11" Foreground="#666666" Margin="0,0,0,5"/>
                                <StackPanel Margin="0,0,0,15">
                                    <CheckBox x:Name="ChkDriverAutomationResult" Content="Automation" Margin="0,3"/>
                                    <CheckBox x:Name="ChkDriverEfficiencyResult" Content="Efficiency Gains" Margin="0,3"/>
                                    <CheckBox x:Name="ChkDriverOptimizationResult" Content="Process Optimization" Margin="0,3"/>
                                    <CheckBox x:Name="ChkDriverStandardizationResult" Content="Standardization" Margin="0,3"/>
                                    <CheckBox x:Name="ChkDriverAucunResult" Content="Aucun" Margin="0,3"/>
                                </StackPanel>
                                
                                <!-- Ambition -->
                                <TextBlock Text="Ambition" FontWeight="Bold" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbAmbitionResult" Height="35" FontSize="13" Margin="0,0,0,15"/>
                                
                                <!-- BÃ©nÃ©ficiaires -->
                                <TextBlock Text="BÃ©nÃ©ficiaires" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock Text="Qui bÃ©nÃ©ficie de ce projet ? (plusieurs choix possibles)" 
                                          FontSize="11" Foreground="#666666" Margin="0,0,0,5"/>
                                <StackPanel Margin="0,0,0,0">
                                    <CheckBox x:Name="ChkBenefSGIResult" Content="SGI" Margin="0,3"/>
                                    <CheckBox x:Name="ChkBenefTFSCResult" Content="TFSC" Margin="0,3"/>
                                    <CheckBox x:Name="ChkBenefTransversalResult" Content="Transversal" Margin="0,3"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- SECTION PHASE 2: Gains -->
                        <Border Background="#FFF3E0" BorderBrush="#FF9800" BorderThickness="1" 
                               CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="GAINS ATTENDUS" FontWeight="Bold" FontSize="14" 
                                          Foreground="#F57C00" Margin="0,0,0,15"/>
                                
                                <!-- Gains Temps -->
                                <TextBlock Text="Gains Temps *" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock Text="Exemples: '15 heures/semaine', '3 jours/mois', '20% workload'" 
                                          FontSize="11" Foreground="#666666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtGainsTempsResult" Height="35" FontSize="13" 
                                        Padding="8" Margin="0,0,0,15"/>
                                
                                <!-- Gains Financiers -->
                                <TextBlock Text="Gains Financiers (optionnel)" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock Text="Exemples: '45000â‚¬ annuels', '3500â‚¬ mensuels', 'N/A'" 
                                          FontSize="11" Foreground="#666666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtGainsFinanciersResult" Height="35" FontSize="13" 
                                        Padding="8" Margin="0,0,0,0"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- SECTION PHASE 2: Ã‰quipes AssignÃ©es -->
                        <Border Background="#F3E5F5" BorderBrush="#9C27B0" BorderThickness="1" 
                               CornerRadius="5" Padding="15" Margin="0,0,0,15">
                            <StackPanel>
                                <TextBlock Text="Ã‰QUIPES ASSIGNÃ‰ES" FontWeight="Bold" FontSize="14" 
                                          Foreground="#7B1FA2" Margin="0,0,0,15"/>
                                
                                <!-- Ã‰quipes (multi-sÃ©lection) -->
                                <TextBlock Text="Ã‰quipes concernÃ©es" FontWeight="Bold" Margin="0,0,0,5"/>
                                <TextBlock Text="SÃ©lectionnez une ou plusieurs Ã©quipes (filtre les BA/Dev)" 
                                          FontSize="11" Foreground="#666666" Margin="0,0,0,5"/>
                                <StackPanel x:Name="PanelEquipesResult">
                                    <!-- CheckBoxes seront gÃ©nÃ©rÃ©es dynamiquement -->
                                </StackPanel>
                            </StackPanel>
                        </Border>
                        
                        <!-- Assignations -->
                        <TextBlock Text="Business Analyst" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ComboBox x:Name="CmbBusinessAnalystResult" Height="35" FontSize="13" Margin="0,0,0,15"/>
                        
                        <!-- Chef de Projet -->
                        <TextBlock Text="Chef de Projet / PO" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ComboBox x:Name="CmbChefProjetResult" Height="35" FontSize="13" Margin="0,0,0,15"/>
                        
                        <!-- Dev Chiffreur -->
                        <TextBlock Text="DÃ©veloppeur (pour chiffrage)" FontWeight="Bold" Margin="0,0,0,5"/>
                        <ComboBox x:Name="CmbDevChiffreurResult" Height="35" FontSize="13" Margin="0,0,0,15"/>

                        <!-- Chiffrage estimÃ© -->
                        <TextBlock Text="â±ï¸ Chiffrage (laissÃ© Ã  0 par dÃ©faut)" FontWeight="Bold" Margin="0,0,0,5"/>
                        <TextBlock Text="Seul le dÃ©veloppeur peut estimer correctement selon la stack technique" 
                                  FontSize="11" Foreground="#FF9800" FontStyle="Italic" Margin="0,0,0,5"/>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,15">
                            <TextBox x:Name="TxtChiffrageResult" 
                                    Width="100" 
                                    Padding="10" 
                                    Margin="0,0,5,0"
                                    Height="35"
                                    FontSize="13"/>
                            <TextBlock Text="jours" 
                                      VerticalAlignment="Center" 
                                      Foreground="#757575" 
                                      Margin="5,0,0,0"/>
                        </StackPanel>

                        <!-- Note explicative -->
                        <Border Background="#FFF9C4" 
                               CornerRadius="6" 
                               Padding="12" 
                               Margin="0,10,0,0"
                               BorderBrush="#FBC02D" 
                               BorderThickness="1">
                            <StackPanel>
                                <TextBlock Text="â„¹ï¸ Note Importante" 
                                          FontWeight="SemiBold" 
                                          Foreground="#F57C00" 
                                          Margin="0,0,0,5"/>
                                <TextBlock TextWrapping="Wrap" 
                                          FontSize="11" 
                                          Foreground="#555">
                                    <Run Text="Ces informations sont des suggestions gÃ©nÃ©rÃ©es par l'IA. "/>
                                    <Run Text="VÃ©rifiez et complÃ©tez tous les champs avant de crÃ©er la demande. "/>
                                    <Run Text="Le processus de validation habituel (BA, CP, chiffrage) restera inchangÃ©." FontWeight="SemiBold"/>
                                </TextBlock>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </StackPanel>
        </ScrollViewer>

        <!-- Pied de page avec boutons -->
        <Border Grid.Row="2" Background="White" BorderBrush="#E0E0E0" BorderThickness="0,1,0,0" Padding="20,15">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button x:Name="BtnAnnuler" 
                       Content="âŒ Annuler" 
                       Style="{StaticResource ActionButton}"
                       Background="#95A5A6" 
                       Foreground="White"
                       Click="BtnAnnuler_Click"/>
                
                <Button x:Name="BtnCreerDemande" 
                       Content="âœ… CrÃ©er la Demande" 
                       Style="{StaticResource ActionButton}"
                       Background="#27AE60" 
                       Foreground="White"
                       IsEnabled="False"
                       Click="BtnCreerDemande_Click"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>
