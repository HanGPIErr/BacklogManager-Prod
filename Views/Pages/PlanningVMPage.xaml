<UserControl x:Class="BacklogManager.Views.Pages.PlanningVMPage"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="#F5F5F5">
    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Margin="20">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Bouton Retour -->
        <Button Grid.Row="0" HorizontalAlignment="Left" Margin="0,0,0,15"
                Height="40" Padding="16,0" Background="#666666" Foreground="White"
                BorderThickness="0" Cursor="Hand" Click="BtnRetour_Click">
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="â† " FontSize="16" FontWeight="Bold" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding BackText, Mode=OneWay}" FontSize="13" FontWeight="SemiBold" VerticalAlignment="Center"/>
            </StackPanel>
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="Button">
                                <Border Background="{TemplateBinding Background}" CornerRadius="8" 
                                        Padding="{TemplateBinding Padding}">
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#555555"/>
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>

        <!-- Header -->
        <Border Grid.Row="1" CornerRadius="10" Padding="20,15" Margin="0,0,0,15">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#00915A" Offset="0"/>
                    <GradientStop Color="#00A566" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" ShadowDepth="2" Opacity="0.2" Color="#00915A"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <TextBlock Text="{Binding PlanningVMText, Mode=OneWay}" FontSize="22" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="Tactical Solutions" FontSize="16" Foreground="White" Opacity="0.9"
                           VerticalAlignment="Center" Margin="15,0,0,0" FontWeight="Medium"/>
            </StackPanel>
        </Border>

        <!-- ContrÃ´les calendrier -->
        <Border Grid.Row="2" CornerRadius="10" Padding="15" Margin="0,0,0,15">
            <Border.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                    <GradientStop Color="#FFFFFF" Offset="0"/>
                    <GradientStop Color="#FAFAFA" Offset="1"/>
                </LinearGradientBrush>
            </Border.Background>
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" ShadowDepth="0" Opacity="0.2" Color="#D0D0D0"/>
            </Border.Effect>
            <StackPanel Orientation="Horizontal">
                <Button x:Name="BtnMoisPrecedent" Content="â—€" Click="BtnMoisPrecedent_Click"
                        Width="40" Height="40" Foreground="White" 
                        BorderThickness="0" FontSize="16" FontWeight="Bold" Cursor="Hand" Margin="0,0,10,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background">
                                <Setter.Value>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#00915A" Offset="0"/>
                                        <GradientStop Color="#00A566" Offset="1"/>
                                    </LinearGradientBrush>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                                            <Border.Effect>
                                                <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.2" Color="#00915A"/>
                                            </Border.Effect>
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#007A4D"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <TextBlock x:Name="TxtMoisAnnee" Text="DÃ©cembre 2025" FontSize="20" FontWeight="Bold" 
                           Foreground="#00915A" VerticalAlignment="Center" MinWidth="200" TextAlignment="Center"/>

                <Button x:Name="BtnMoisSuivant" Content="â–¶" Click="BtnMoisSuivant_Click"
                        Width="40" Height="40" Foreground="White" 
                        BorderThickness="0" FontSize="16" FontWeight="Bold" Cursor="Hand" Margin="10,0,15,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Background">
                                <Setter.Value>
                                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="#00915A" Offset="0"/>
                                        <GradientStop Color="#00A566" Offset="1"/>
                                    </LinearGradientBrush>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8">
                                            <Border.Effect>
                                                <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.2" Color="#00915A"/>
                                            </Border.Effect>
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#007A4D"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>

                <Button Content="{Binding TodayText, Mode=OneWay}" Click="BtnAujourdhui_Click"
                        Padding="12,8" Background="#E0E0E0" Foreground="#333" 
                        BorderThickness="0" FontSize="12" FontWeight="SemiBold" Cursor="Hand" Margin="0,0,10,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="4" 
                                                Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" Value="#D0D0D0"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Button.Style>
                </Button>
            </StackPanel>
        </Border>

        <!-- Calendrier -->
        <Border Grid.Row="3" Background="White" CornerRadius="12" Padding="20"
                BorderBrush="#E0E0E0" BorderThickness="1">
            <Border.Effect>
                <DropShadowEffect BlurRadius="16" ShadowDepth="0" Opacity="0.2" Color="#D0D0D0"/>
            </Border.Effect>
            
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- En-tÃªtes des jours -->
                    <Grid Grid.Row="0" Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock Grid.Column="0" Text="{Binding MondayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#00915A" HorizontalAlignment="Center" Padding="0,10"/>
                        <TextBlock Grid.Column="1" Text="{Binding TuesdayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#00915A" HorizontalAlignment="Center" Padding="0,10"/>
                        <TextBlock Grid.Column="2" Text="{Binding WednesdayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#00915A" HorizontalAlignment="Center" Padding="0,10"/>
                        <TextBlock Grid.Column="3" Text="{Binding ThursdayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#00915A" HorizontalAlignment="Center" Padding="0,10"/>
                        <TextBlock Grid.Column="4" Text="{Binding FridayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#00915A" HorizontalAlignment="Center" Padding="0,10"/>
                        <TextBlock Grid.Column="5" Text="{Binding SaturdayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#999" HorizontalAlignment="Center" Padding="0,10"/>
                        <TextBlock Grid.Column="6" Text="{Binding SundayText, Mode=OneWay}" FontSize="12" FontWeight="Bold" 
                                   Foreground="#999" HorizontalAlignment="Center" Padding="0,10"/>
                    </Grid>

                    <!-- Grille des jours -->
                    <ItemsControl Grid.Row="1" x:Name="CalendrierItems">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="7" Rows="6"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Command="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=JourClickCommand}"
                                        CommandParameter="{Binding}"
                                        Padding="0" Margin="2" BorderThickness="1" 
                                        HorizontalContentAlignment="Stretch" VerticalContentAlignment="Stretch"
                                        Cursor="Hand">
                                    <Button.Style>
                                        <Style TargetType="Button">
                                            <Setter Property="Background" Value="White"/>
                                            <Setter Property="BorderBrush" Value="#E0E0E0"/>
                                            <Setter Property="Template">
                                                <Setter.Value>
                                                    <ControlTemplate TargetType="Button">
                                                        <Border Background="{TemplateBinding Background}" 
                                                                BorderBrush="{TemplateBinding BorderBrush}"
                                                                BorderThickness="{TemplateBinding BorderThickness}"
                                                                CornerRadius="6">
                                                            <ContentPresenter/>
                                                        </Border>
                                                    </ControlTemplate>
                                                </Setter.Value>
                                            </Setter>
                                            <Style.Triggers>
                                                <!-- Jour actuel -->
                                                <DataTrigger Binding="{Binding EstAujourdhui}" Value="True">
                                                    <Setter Property="Background" Value="#C8E6C9"/>
                                                    <Setter Property="BorderBrush" Value="#00915A"/>
                                                    <Setter Property="BorderThickness" Value="2"/>
                                                </DataTrigger>
                                                <!-- Demande d'Ã©change en attente -->
                                                <DataTrigger Binding="{Binding ADemandeEchange}" Value="True">
                                                    <Setter Property="Background" Value="#FFF3E0"/>
                                                    <Setter Property="BorderBrush" Value="#FF9800"/>
                                                    <Setter Property="BorderThickness" Value="2"/>
                                                </DataTrigger>
                                                <!-- Weekend -->
                                                <DataTrigger Binding="{Binding EstWeekend}" Value="True">
                                                    <Setter Property="Background" Value="#E0E0E0"/>
                                                </DataTrigger>
                                                <!-- Jour fÃ©riÃ© -->
                                                <DataTrigger Binding="{Binding EstJourFerie}" Value="True">
                                                    <Setter Property="Background" Value="#FFE0B2"/>
                                                </DataTrigger>
                                                <!-- Hors du mois -->
                                                <DataTrigger Binding="{Binding EstHorsMois}" Value="True">
                                                    <Setter Property="Opacity" Value="0.3"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Button.Style>
                                    
                                    <Grid MinHeight="90">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="*"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- NumÃ©ro du jour -->
                                        <TextBlock Grid.Row="0" Text="{Binding Numero}" 
                                                   FontSize="14" FontWeight="SemiBold" 
                                                   Margin="5,5,5,2" HorizontalAlignment="Right">
                                            <TextBlock.Style>
                                                <Style TargetType="TextBlock">
                                                    <Setter Property="Foreground" Value="#333"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding EstWeekend}" Value="True">
                                                            <Setter Property="Foreground" Value="#999"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding EstJourFerie}" Value="True">
                                                            <Setter Property="Foreground" Value="#FF9800"/>
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding EstAujourdhui}" Value="True">
                                                            <Setter Property="Foreground" Value="#00915A"/>
                                                            <Setter Property="FontWeight" Value="Bold"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </TextBlock.Style>
                                        </TextBlock>

                                        <!-- Zone centrale : icÃ´ne jour fÃ©riÃ© OU membre assignÃ© -->
                                        <Grid Grid.Row="1">
                                            <!-- IcÃ´ne jour fÃ©riÃ© -->
                                            <Image Source="{Binding IconeJourFerie}" 
                                                   Width="64" Height="64"
                                                   VerticalAlignment="Center" HorizontalAlignment="Center"
                                                   Stretch="Uniform"
                                                   ToolTip="{Binding NomJourFerie}"
                                                   Visibility="{Binding VisibiliteJourFerie}"/>
                                            
                                            <!-- Membre assignÃ© -->
                                            <StackPanel VerticalAlignment="Center" Margin="5"
                                                        Visibility="{Binding VisibiliteAssignation}">
                                                <Border CornerRadius="6" Padding="8,4" Background="#E8F5E9">
                                                    <TextBlock Text="{Binding NomMembre}" 
                                                               FontSize="11" FontWeight="SemiBold"
                                                               Foreground="#00915A" TextAlignment="Center"
                                                               TextWrapping="Wrap"/>
                                                </Border>
                                            </StackPanel>
                                        </Grid>

                                        <!-- Badge demande d'Ã©change en attente -->
                                        <Border Grid.Row="2" CornerRadius="8" Padding="6,3" Margin="4,2"
                                                HorizontalAlignment="Center"
                                                Background="#FF9800"
                                                Visibility="{Binding VisibiliteDemandeEchange}">
                                            <Border.Effect>
                                                <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.4" Color="#FF9800"/>
                                            </Border.Effect>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="ðŸ”„" FontSize="12" Margin="0,0,4,0"/>
                                                <TextBlock Text="Ã‰change demandÃ©" 
                                                           FontSize="10" FontWeight="Bold"
                                                           Foreground="White"
                                                           ToolTip="Cliquez pour accepter l'Ã©change"/>
                                            </StackPanel>
                                        </Border>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </Grid>
            </ScrollViewer>
        </Border>
    </Grid>
</UserControl>
