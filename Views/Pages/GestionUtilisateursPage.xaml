<Page x:Class="BacklogManager.Views.Pages.GestionUtilisateursPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      Background="Transparent">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Liste utilisateurs avec scroll (sous le header) -->
        <Border Grid.Row="1" Background="White" CornerRadius="12" BorderThickness="0" Margin="0,80,0,10">
            <Border.Effect>
                <DropShadowEffect Color="#E0E0E0" BlurRadius="12" ShadowDepth="2" Opacity="0.2" Direction="270"/>
            </Border.Effect>
            <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="20">
                <DataGrid x:Name="LstUtilisateurs" AutoGenerateColumns="False" 
                          IsReadOnly="True" CanUserAddRows="False" SelectionMode="Single"
                          HeadersVisibility="Column" GridLinesVisibility="None"
                          BorderThickness="0" RowHeight="50"
                          AlternatingRowBackground="#FAFAFA" RowBackground="White"
                          VerticalScrollBarVisibility="Disabled"
                          HorizontalScrollBarVisibility="Disabled"
                          MouseDoubleClick="LstUtilisateurs_MouseDoubleClick">
                <DataGrid.ColumnHeaderStyle>
                    <Style TargetType="DataGridColumnHeader">
                        <Setter Property="Background" Value="#F5F5F5"/>
                        <Setter Property="Foreground" Value="#1A1919"/>
                        <Setter Property="FontWeight" Value="Bold"/>
                        <Setter Property="FontSize" Value="13"/>
                        <Setter Property="Padding" Value="15,12"/>
                        <Setter Property="BorderThickness" Value="0,0,0,2"/>
                        <Setter Property="BorderBrush" Value="#E0E0E0"/>
                    </Style>
                </DataGrid.ColumnHeaderStyle>
                <DataGrid.CellStyle>
                    <Style TargetType="DataGridCell">
                        <Setter Property="BorderThickness" Value="0"/>
                        <Setter Property="Padding" Value="15,10"/>
                        <Setter Property="FontSize" Value="13"/>
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="DataGridCell">
                                    <Border Padding="{TemplateBinding Padding}" Background="{TemplateBinding Background}">
                                        <ContentPresenter VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </DataGrid.CellStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn x:Name="ColFullName" Header="Nom complet" Binding="{Binding Nom}" Width="2*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#1A1919"/>
                                <Setter Property="FontWeight" Value="SemiBold"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn x:Name="ColWindowsUsername" Header="Username Windows" Binding="{Binding UsernameWindows}" Width="1.5*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#1A1919"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn x:Name="ColRole" Header="RÃ´le" Binding="{Binding RoleNom}" Width="1.5*">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Foreground" Value="#1A1919"/>
                                <Setter Property="FontWeight" Value="Medium"/>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTemplateColumn x:Name="ColStatus" Header="Statut" Width="1.2*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border Background="{Binding StatutCouleurBadge}" 
                                        CornerRadius="12" Padding="10,4" HorizontalAlignment="Left">
                                    <TextBlock Text="{Binding Statut}" 
                                               Foreground="White" FontSize="11" FontWeight="Bold"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTemplateColumn x:Name="ColActive" Header="Actif" Width="0.8*">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Border CornerRadius="12" Padding="10,4" HorizontalAlignment="Center">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Background" Value="#4CAF50"/>
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Actif}" Value="False">
                                                    <Setter Property="Background" Value="#9E9E9E"/>
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="{Binding ActifTexte}" FontSize="11" FontWeight="Bold" Foreground="White"/>
                                </Border>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
                </DataGrid>
            </ScrollViewer>
        </Border>

        <!-- Header fixe avec actions (toujours visible en haut, par-dessus le reste) -->
        <Border Grid.Row="0" Background="White" CornerRadius="10" Padding="18" Margin="0"
                Panel.ZIndex="1000">
            <Border.Effect>
                <DropShadowEffect Color="#E0E0E0" BlurRadius="10" ShadowDepth="2" Opacity="0.2" Direction="270"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Boutons d'action -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">
                    <Button Click="BtnNouvelUtilisateur_Click"
                        Background="#00915A" Foreground="White" Padding="18,10" 
                        BorderThickness="0" Cursor="Hand" FontWeight="Bold" FontSize="13">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                                            <Border.Effect>
                                                <DropShadowEffect Color="#00915A" BlurRadius="8" ShadowDepth="0" Opacity="0.3"/>
                                            </Border.Effect>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="âž•" FontSize="14" Margin="0,0,6,0"/>
                                                <TextBlock Text="{Binding Path=NewUserText, RelativeSource={RelativeSource AncestorType=Page}}" FontSize="13" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Click="BtnModifierUtilisateur_Click" Margin="10,0,0,0"
                        Background="#1976D2" Foreground="White" Padding="18,10" 
                        BorderThickness="0" Cursor="Hand" FontWeight="Bold" FontSize="13">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="âœï¸" FontSize="14" Margin="0,0,6,0"/>
                                                <TextBlock Text="{Binding Path=ModifyText, RelativeSource={RelativeSource AncestorType=Page}}" FontSize="13" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Click="BtnSupprimerUtilisateur_Click" Margin="10,0,0,0"
                        Background="#C62828" Foreground="White" Padding="18,10" 
                        BorderThickness="0" Cursor="Hand" FontWeight="Bold" FontSize="13">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="ðŸ—‘ï¸" FontSize="14" Margin="0,0,6,0"/>
                                                <TextBlock Text="{Binding Path=DeleteText, RelativeSource={RelativeSource AncestorType=Page}}" FontSize="13" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
                <Button Click="BtnActualiser_Click" Margin="10,0,0,0"
                        Background="#F5F5F5" Foreground="#1A1919" Padding="18,10" 
                        BorderThickness="1" BorderBrush="#E0E0E0" Cursor="Hand" FontWeight="Bold" FontSize="13">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border Background="{TemplateBinding Background}" CornerRadius="8" Padding="{TemplateBinding Padding}"
                                                BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}">
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="ðŸ”„" FontSize="14" Margin="0,0,6,0"/>
                                                <TextBlock Text="{Binding Path=RefreshText, RelativeSource={RelativeSource AncestorType=Page}}" FontSize="13" FontWeight="Bold"/>
                                            </StackPanel>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                </Button>
                </StackPanel>

                <!-- Barre de recherche Ã  droite -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ”" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0" Foreground="#757575"/>
                    <TextBox x:Name="TxtRecherche" 
                             Width="300" 
                             Padding="10,8"
                             FontSize="13"
                             Background="#F5F5F5"
                             BorderBrush="#E0E0E0"
                             BorderThickness="1"
                             TextChanged="TxtRecherche_TextChanged">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TextBox">
                                            <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="8"
                                                    Padding="{TemplateBinding Padding}">
                                                <ScrollViewer x:Name="PART_ContentHost" />
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TextBox.Style>
                        <TextBox.Resources>
                            <Style TargetType="{x:Type Border}">
                                <Setter Property="CornerRadius" Value="8"/>
                            </Style>
                        </TextBox.Resources>
                    </TextBox>
                    <TextBlock x:Name="TxtSearchPlaceholder" Text="{Binding Path=SearchPlaceholderText, RelativeSource={RelativeSource AncestorType=Page}}" 
                               IsHitTestVisible="False"
                               Foreground="#9E9E9E"
                               FontSize="13"
                               Margin="-290,0,0,0"
                               Padding="10,8"
                               VerticalAlignment="Center">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=TxtRecherche}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Pagination en bas (toujours visible) -->
        <Border Grid.Row="2" Background="White" CornerRadius="10" Padding="15" Margin="0,0,0,0"
                Panel.ZIndex="1000">
            <Border.Effect>
                <DropShadowEffect Color="#E0E0E0" BlurRadius="10" ShadowDepth="2" Opacity="0.2" Direction="270"/>
            </Border.Effect>
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Info pagination -->
                <TextBlock Grid.Column="0" VerticalAlignment="Center" FontSize="13" Foreground="#666">
                    <Run x:Name="TxtDisplayingFrom" Text="Affichage de "/>
                    <Run x:Name="TxtDebutPage" Text="1" FontWeight="Bold" Foreground="#1A1919"/>
                    <Run x:Name="TxtTo" Text=" Ã  "/>
                    <Run x:Name="TxtFinPage" Text="25" FontWeight="Bold" Foreground="#1A1919"/>
                    <Run x:Name="TxtOf" Text=" sur "/>
                    <Run x:Name="TxtTotalUtilisateurs" Text="0" FontWeight="Bold" Foreground="#1A1919"/>
                    <Run x:Name="TxtTotalUsersLabel" Text=" utilisateur(s)"/>
                </TextBlock>

                <!-- Navigation pagination -->
                <StackPanel Grid.Column="1" Orientation="Horizontal">
                    <Button x:Name="BtnPagePrecedente" Click="BtnPagePrecedente_Click"
                            Padding="12,6" Margin="0,0,10,0"
                            Background="#F5F5F5" Foreground="#1A1919" BorderBrush="#E0E0E0" BorderThickness="1"
                            FontSize="12" FontWeight="SemiBold" Cursor="Hand">
                        <Button.Content>
                            <TextBlock x:Name="TxtPrevious" Text="â—€ PrÃ©cÃ©dent"/>
                        </Button.Content>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    BorderBrush="{TemplateBinding BorderBrush}" 
                                                    BorderThickness="{TemplateBinding BorderThickness}"
                                                    CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#E0E0E0"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Opacity" Value="0.5"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <TextBlock VerticalAlignment="Center" Margin="0,0,10,0" FontSize="12" Foreground="#666">
                        <Run x:Name="TxtPageLabel" Text="Page "/>
                        <Run x:Name="TxtNumeroPage" Text="1" FontWeight="Bold" Foreground="#1A1919"/>
                        <Run Text=" / "/>
                        <Run x:Name="TxtNombrePages" Text="1" FontWeight="Bold" Foreground="#1A1919"/>
                    </TextBlock>

                    <Button x:Name="BtnPageSuivante" Click="BtnPageSuivante_Click"
                            Padding="12,6"
                            Background="#1976D2" Foreground="White" BorderThickness="0"
                            FontSize="12" FontWeight="SemiBold" Cursor="Hand">
                        <Button.Content>
                            <TextBlock x:Name="TxtNext" Text="Suivant â–¶"/>
                        </Button.Content>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#1565C0"/>
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Opacity" Value="0.5"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
