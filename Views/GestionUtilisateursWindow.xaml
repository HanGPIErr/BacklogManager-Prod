<Window x:Class="BacklogManager.Views.GestionUtilisateursWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:local="clr-namespace:BacklogManager.Domain"
        Title="Gestion des Utilisateurs et RÃ´les" Height="650" Width="900"
        WindowStartupLocation="CenterOwner"
        Background="#F5F5F5"
        ResizeMode="CanResize">
    <Window.Resources>
        <local:EnumToCollectionConverter x:Key="EnumToCollectionConverter"/>
        <Style x:Key="BNPButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#00915A"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="15,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="4"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#007A4D"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid>
        <!-- Header -->
        <Border Height="70" VerticalAlignment="Top" Background="#00915A">
            <StackPanel VerticalAlignment="Center" Margin="20,0">
                <TextBlock Text="ðŸ‘¥ GESTION DES UTILISATEURS ET RÃ”LES" 
                           FontSize="20" FontWeight="Bold" Foreground="White"/>
                <TextBlock Text="Administration des comptes et permissions" 
                           FontSize="12" Foreground="White" Opacity="0.9" Margin="0,5,0,0"/>
            </StackPanel>
        </Border>

        <!-- Tabs -->
        <TabControl Margin="20,90,20,20" Background="White">
            <!-- Tab Utilisateurs -->
            <TabItem Header="ðŸ‘¤ Utilisateurs" FontSize="14" FontWeight="SemiBold">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Formulaire -->
                    <Border Grid.Row="0" Background="#F8F9FA" Padding="15" CornerRadius="6" Margin="0,0,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Username Windows -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,10">
                                <TextBlock Text="Username Windows *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtUsername" FontSize="13" Padding="8" Height="32"/>
                            </StackPanel>

                            <!-- Nom -->
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,10,10">
                                <TextBlock Text="Nom *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtNom" FontSize="13" Padding="8" Height="32"/>
                            </StackPanel>

                            <!-- PrÃ©nom -->
                            <StackPanel Grid.Row="0" Grid.Column="2" Margin="10,0,0,10">
                                <TextBlock Text="PrÃ©nom *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtPrenom" FontSize="13" Padding="8" Height="32"/>
                            </StackPanel>

                            <!-- Email -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,10,10">
                                <TextBlock Text="Email *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtEmail" FontSize="13" Padding="8" Height="32"/>
                            </StackPanel>

                            <!-- RÃ´le -->
                            <StackPanel Grid.Row="1" Grid.Column="2" Margin="10,0,0,10">
                                <TextBlock Text="RÃ´le *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbRole" FontSize="13" Padding="8" Height="32"
                                          DisplayMemberPath="Nom" SelectedValuePath="Id"/>
                            </StackPanel>

                            <!-- Ã‰quipe -->
                            <StackPanel Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Margin="0,0,10,10">
                                <TextBlock Text="ðŸ¢ Ã‰quipe" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbEquipe" FontSize="13" Padding="8" Height="32"
                                          DisplayMemberPath="Nom" SelectedValuePath="Id">
                                    <ComboBox.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock>
                                                <Run Text="ðŸ¢ " Foreground="#00915A"/>
                                                <Run Text="{Binding Nom}" FontWeight="SemiBold"/>
                                                <Run Text=" (" Foreground="#666"/>
                                                <Run Text="{Binding Code}" Foreground="#666"/>
                                                <Run Text=")" Foreground="#666"/>
                                            </TextBlock>
                                        </DataTemplate>
                                    </ComboBox.ItemTemplate>
                                </ComboBox>
                            </StackPanel>

                            <!-- Actif -->
                            <CheckBox Grid.Row="3" Grid.Column="0" x:Name="ChkActif" 
                                      Content="Utilisateur actif" IsChecked="True" 
                                      FontSize="13" VerticalAlignment="Center"/>

                            <!-- Boutons -->
                            <StackPanel Grid.Row="3" Grid.Column="2" Orientation="Horizontal" 
                                        HorizontalAlignment="Right">
                                <Button x:Name="BtnAjouterUser" Content="âž• Ajouter" 
                                        Style="{StaticResource BNPButtonStyle}" 
                                        Click="BtnAjouterUser_Click" Width="100"/>
                                <Button x:Name="BtnModifierUser" Content="âœï¸ Modifier" 
                                        Style="{StaticResource BNPButtonStyle}" 
                                        Click="BtnModifierUser_Click" Width="100" Margin="8,0,0,0"
                                        Visibility="Collapsed"/>
                                <Button x:Name="BtnAnnulerUser" Content="âœ–ï¸ Annuler" 
                                        Background="#6C757D"
                                        Foreground="White" BorderThickness="0" Padding="15,8"
                                        Click="BtnAnnulerUser_Click" Width="100" Margin="8,0,0,0"
                                        Visibility="Collapsed"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Liste -->
                    <DataGrid Grid.Row="1" x:Name="DgUtilisateurs" 
                              AutoGenerateColumns="False" 
                              IsReadOnly="True"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              HeadersVisibility="Column"
                              RowBackground="White"
                              AlternatingRowBackground="#F8F9FA"
                              SelectionChanged="DgUtilisateurs_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Username" Binding="{Binding UsernameWindows}" Width="100"/>
                            <DataGridTextColumn Header="Nom" Binding="{Binding Nom}" Width="100"/>
                            <DataGridTextColumn Header="PrÃ©nom" Binding="{Binding Prenom}" Width="100"/>
                            <DataGridTextColumn Header="Email" Binding="{Binding Email}" Width="*"/>
                            <DataGridTextColumn Header="RÃ´le" Binding="{Binding RoleNom}" Width="120"/>
                            <DataGridTextColumn Header="Ã‰quipe" Binding="{Binding EquipeNom}" Width="150"/>
                            <DataGridCheckBoxColumn Header="Actif" Binding="{Binding Actif}" Width="60"/>
                            <DataGridTemplateColumn Header="Actions" Width="120">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="âœï¸" Width="30" Height="30" 
                                                    Background="#00915A" Foreground="White"
                                                    BorderThickness="0" Margin="0,0,5,0"
                                                    Click="BtnEditUser_Click" Tag="{Binding}"/>
                                            <Button Content="ðŸ—‘ï¸" Width="30" Height="30"
                                                    Background="#D32F2F" Foreground="White"
                                                    BorderThickness="0"
                                                    Click="BtnDeleteUser_Click" Tag="{Binding}"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>

            <!-- Tab RÃ´les -->
            <TabItem Header="ðŸ” RÃ´les" FontSize="14" FontWeight="SemiBold">
                <Grid Margin="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <!-- Formulaire RÃ´le -->
                    <Border Grid.Row="0" Background="#F8F9FA" Padding="15" CornerRadius="6" Margin="0,0,0,15">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Nom du rÃ´le -->
                            <StackPanel Grid.Row="0" Grid.Column="0" Margin="0,0,10,10">
                                <TextBlock Text="Nom du rÃ´le *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <TextBox x:Name="TxtNomRole" FontSize="13" Padding="8" Height="32"/>
                            </StackPanel>

                            <!-- Type de rÃ´le -->
                            <StackPanel Grid.Row="0" Grid.Column="1" Margin="10,0,10,10">
                                <TextBlock Text="Type *" FontSize="11" Foreground="#666" Margin="0,0,0,5"/>
                                <ComboBox x:Name="CmbTypeRole" FontSize="13" Padding="8" Height="32"
                                          ItemsSource="{Binding Source={StaticResource EnumToCollectionConverter}, Converter={StaticResource EnumToCollectionConverter}, ConverterParameter={x:Type local:RoleType}}"/>
                            </StackPanel>

                            <!-- Permissions -->
                            <StackPanel Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3" Margin="0,10,0,10">
                                <TextBlock Text="Permissions" FontSize="12" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <WrapPanel>
                                    <CheckBox x:Name="ChkCreerDemandes" Content="CrÃ©er demandes" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkChiffrer" Content="Chiffrer" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkPrioriser" Content="Prioriser" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkModifierTaches" Content="Modifier tÃ¢ches" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkSupprimerTaches" Content="Supprimer tÃ¢ches" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkGererUtilisateurs" Content="GÃ©rer utilisateurs" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkVoirKPI" Content="Voir KPI" Margin="0,0,15,5"/>
                                    <CheckBox x:Name="ChkGererReferentiels" Content="GÃ©rer rÃ©fÃ©rentiels" Margin="0,0,15,5"/>
                                </WrapPanel>
                            </StackPanel>

                            <!-- Boutons -->
                            <StackPanel Grid.Row="2" Grid.Column="2" Orientation="Horizontal" 
                                        HorizontalAlignment="Right">
                                <Button x:Name="BtnAjouterRole" Content="âž• Ajouter" 
                                        Style="{StaticResource BNPButtonStyle}" 
                                        Click="BtnAjouterRole_Click" Width="100"/>
                                <Button x:Name="BtnModifierRole" Content="âœï¸ Modifier" 
                                        Style="{StaticResource BNPButtonStyle}" 
                                        Click="BtnModifierRole_Click" Width="100" Margin="8,0,0,0"
                                        Visibility="Collapsed"/>
                            </StackPanel>
                        </Grid>
                    </Border>

                    <!-- Liste des rÃ´les -->
                    <DataGrid Grid.Row="1" x:Name="DgRoles" 
                              AutoGenerateColumns="False" 
                              IsReadOnly="True"
                              SelectionMode="Single"
                              GridLinesVisibility="Horizontal"
                              SelectionChanged="DgRoles_SelectionChanged">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Nom" Binding="{Binding Nom}" Width="200"/>
                            <DataGridTextColumn Header="Type" Binding="{Binding Type}" Width="150"/>
                            <DataGridCheckBoxColumn Header="CrÃ©er demandes" Binding="{Binding PeutCreerDemandes}" Width="120"/>
                            <DataGridCheckBoxColumn Header="Chiffrer" Binding="{Binding PeutChiffrer}" Width="80"/>
                            <DataGridCheckBoxColumn Header="Prioriser" Binding="{Binding PeutPrioriser}" Width="80"/>
                            <DataGridCheckBoxColumn Header="Modifier tÃ¢ches" Binding="{Binding PeutModifierTaches}" Width="120"/>
                            <DataGridCheckBoxColumn Header="Supprimer tÃ¢ches" Binding="{Binding PeutSupprimerTaches}" Width="130"/>
                            <DataGridCheckBoxColumn Header="GÃ©rer users" Binding="{Binding PeutGererUtilisateurs}" Width="100"/>
                            <DataGridCheckBoxColumn Header="Voir KPI" Binding="{Binding PeutVoirKPI}" Width="80"/>
                            <DataGridCheckBoxColumn Header="Actif" Binding="{Binding Actif}" Width="60"/>
                        </DataGrid.Columns>
                    </DataGrid>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</Window>
