<UserControl x:Class="BacklogManager.Views.ArchivesView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:services="clr-namespace:BacklogManager.Services"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             Background="#F5F5F5">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Header avec filtres -->
        <Border Grid.Row="0" Background="White" Padding="30,25" 
                BorderThickness="0,0,0,1" BorderBrush="#E0E0E0">
            <StackPanel>
                <!-- Titre -->
                <Grid Margin="0,0,0,25">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0" Orientation="Horizontal">
                        <TextBlock Text="ðŸ“¦" FontSize="32" VerticalAlignment="Center" Margin="0,0,12,0"/>
                        <StackPanel>
                            <TextBlock Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Title], Mode=OneWay}" FontSize="28" FontWeight="Bold" Foreground="#00915A"/>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Subtitle], Mode=OneWay}" FontSize="13" Foreground="#666" Margin="0,2,8,0"/>
                                <TextBlock FontSize="13" Foreground="#FF5722" Margin="0,2,0,0" FontWeight="Bold">
                                    <Run Text="("/>
                                    <Run Text="{Binding TachesArchivees.Count, Mode=OneWay}"/>
                                    <Run Text=" "/>
                                    <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Found], Mode=OneWay}"/>
                                    <Run Text=")"/>
                                </TextBlock>
                            </StackPanel>
                        </StackPanel>
                    </StackPanel>

                    <Button Grid.Column="1" 
                            Command="{Binding RafraichirCommand}"
                            Background="#00915A" Foreground="White" BorderThickness="0"
                            FontSize="13" FontWeight="Bold" Padding="18,10" Cursor="Hand"
                            Height="38">
                        <Button.Content>
                            <TextBlock>
                                <Run Text="ðŸ”„ "/>
                                <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Refresh], Mode=OneWay}"/>
                            </TextBlock>
                        </Button.Content>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="#00915A"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    CornerRadius="6" 
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#007A4D"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>

                <!-- Filtres -->
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="2*"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="15"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Recherche -->
                    <Border Grid.Column="0" Background="White" BorderBrush="#CCC" BorderThickness="1" 
                            CornerRadius="6" Padding="12,8">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="ðŸ”" FontSize="16" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            <TextBox Grid.Column="1" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}" 
                                     BorderThickness="0" Background="Transparent" VerticalAlignment="Center"
                                     FontSize="13">
                                <TextBox.Style>
                                    <Style TargetType="TextBox">
                                        <Style.Triggers>
                                            <Trigger Property="Text" Value="">
                                                <Setter Property="Background">
                                                    <Setter.Value>
                                                        <VisualBrush Stretch="None" AlignmentX="Left">
                                                            <VisualBrush.Visual>
                                                                <TextBlock Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Search], Mode=OneWay}" Foreground="#999" FontSize="13"/>
                                                            </VisualBrush.Visual>
                                                        </VisualBrush>
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBox.Style>
                            </TextBox>
                        </Grid>
                    </Border>

                    <!-- PÃ©riode -->
                    <ComboBox Grid.Column="2" ItemsSource="{Binding Periodes}" 
                              SelectedItem="{Binding PeriodeSelectionnee}"
                              FontSize="13" Height="38" Padding="10,0">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox">
                                <Setter Property="BorderBrush" Value="#CCC"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Style>
                        </ComboBox.Style>
                    </ComboBox>

                    <!-- Projet -->
                    <ComboBox Grid.Column="4" ItemsSource="{Binding Projets}" 
                              SelectedValue="{Binding ProjetSelectionneId}" 
                              SelectedValuePath="Id" DisplayMemberPath="Nom"
                              FontSize="13" Height="38" Padding="10,0">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox">
                                <Setter Property="BorderBrush" Value="#CCC"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Style>
                        </ComboBox.Style>
                    </ComboBox>

                    <!-- Dev -->
                    <ComboBox Grid.Column="6" ItemsSource="{Binding Devs}" 
                              SelectedValue="{Binding DevSelectionneId}" 
                              SelectedValuePath="Id" DisplayMemberPath="Nom"
                              FontSize="13" Height="38" Padding="10,0">
                        <ComboBox.Style>
                            <Style TargetType="ComboBox">
                                <Setter Property="BorderBrush" Value="#CCC"/>
                                <Setter Property="BorderThickness" Value="1"/>
                            </Style>
                        </ComboBox.Style>
                    </ComboBox>

                    <!-- RÃ©initialiser filtres -->
                    <Button Grid.Column="8" 
                            Command="{Binding ResetFiltresCommand}"
                            Background="#FF5722" Foreground="White" BorderThickness="0"
                            FontSize="12" FontWeight="Bold" Padding="15,10" Cursor="Hand"
                            Height="38">
                        <Button.Content>
                            <TextBlock>
                                <Run Text="âœ– "/>
                                <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Projects_Reset], Mode=OneWay}"/>
                            </TextBlock>
                        </Button.Content>
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="#FF5722"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}" 
                                                    CornerRadius="6" 
                                                    Padding="{TemplateBinding Padding}">
                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#E64A19"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </StackPanel>
        </Border>

        <!-- Liste des archives -->
        <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="30,20">
            <ItemsControl ItemsSource="{Binding TachesArchivees}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border Background="White" BorderBrush="#FFB800" BorderThickness="2" 
                                CornerRadius="10" Padding="22,18" Margin="0,0,0,14" Cursor="Hand">
                            <Border.Effect>
                                <DropShadowEffect BlurRadius="8" ShadowDepth="0" Opacity="0.15" Color="#FFB800"/>
                            </Border.Effect>

                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>

                                <!-- En-tÃªte -->
                                <Grid Grid.Row="0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- Badge ARCHIVÃ‰E -->
                                    <Border Grid.Column="0" Background="#FFB800" CornerRadius="4" Padding="8,4" 
                                            Margin="0,0,12,0" VerticalAlignment="Center">
                                        <TextBlock FontSize="10" FontWeight="Bold" Foreground="White">
                                            <Run Text="ðŸ“¦ "/>
                                            <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_BadgeArchived], Mode=OneWay}"/>
                                        </TextBlock>
                                    </Border>

                                    <!-- Titre -->
                                    <TextBlock Grid.Column="1" Text="{Binding Item.Titre}" 
                                               FontSize="17" FontWeight="Bold" Foreground="#333"
                                               TextWrapping="Wrap" VerticalAlignment="Center"
                                               Opacity="0.6"/>

                                    <!-- Bouton DÃ©sarchiver -->
                                    <Button Grid.Column="2" 
                                            Command="{Binding DataContext.DesarchiverTacheCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                            CommandParameter="{Binding Item}"
                                            Background="#4CAF50" Foreground="White" BorderThickness="0"
                                            FontSize="12" FontWeight="Bold" Padding="12,6" Cursor="Hand"
                                            VerticalAlignment="Center">
                                        <Button.Content>
                                            <TextBlock>
                                                <Run Text="â™»ï¸ "/>
                                                <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Unarchive], Mode=OneWay}"/>
                                            </TextBlock>
                                        </Button.Content>
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Background" Value="#4CAF50"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" 
                                                                    CornerRadius="5" 
                                                                    Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Background" Value="#45A049"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>

                                <!-- Informations -->
                                <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,12,0,0" Opacity="0.5">
                                    <TextBlock Text="ðŸ“…" FontSize="12" Margin="0,0,5,0"/>
                                    <TextBlock FontSize="12" Foreground="#666" Margin="0,0,20,0">
                                        <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_ArchivedOn], Mode=OneWay}"/>
                                        <Run Text=" "/>
                                        <Run Text="{Binding Item.DateDerniereMaj, StringFormat='dd/MM/yyyy Ã  HH:mm'}" FontWeight="Bold"/>
                                    </TextBlock>

                                    <TextBlock Text="ðŸ“" FontSize="12" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding ProjetNom}" FontSize="12" Foreground="#666" 
                                               FontWeight="Bold" Margin="0,0,20,0"/>

                                    <TextBlock Text="ðŸ‘¤" FontSize="12" Margin="0,0,5,0"/>
                                    <TextBlock Text="{Binding DevNom}" FontSize="12" Foreground="#666" 
                                               FontWeight="Bold" Margin="0,0,20,0"/>

                                    <TextBlock Text="â±ï¸" FontSize="12" Margin="0,0,5,0"/>
                                    <TextBlock FontSize="12" Foreground="#666">
                                        <Run Text="{Binding TempsReel, StringFormat='{}{0:F1}h'}"/>
                                        <Run Text=" "/>
                                        <Run Text="{Binding Source={x:Static services:LocalizationService.Instance}, Path=[Archives_Realized], Mode=OneWay}"/>
                                    </TextBlock>
                                </StackPanel>

                                <!-- Description -->
                                <TextBlock Grid.Row="2" Text="{Binding Item.Description}" 
                                           FontSize="13" Foreground="#666" TextWrapping="Wrap" 
                                           Margin="0,8,0,0" Opacity="0.5"
                                           MaxHeight="60" TextTrimming="CharacterEllipsis"/>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</UserControl>
